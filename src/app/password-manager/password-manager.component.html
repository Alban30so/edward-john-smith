<div class="container">
  <h1>Gestionnaire de Mots de Passe</h1>
  
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Site Web</th>
          <th>Identifiant</th>
          <th>Mot de Passe</th>
          <th class="actions-col">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="passwords.length === 0">
          <td colspan="4">Aucun mot de passe enregistré.</td>
        </tr>
        
        <tr *ngFor="let entry of passwords; let i = index">

          <td>
            <span *ngIf="editingIndex !== i">{{ entry.website }}</span>
            <input *ngIf="editingIndex === i" [(ngModel)]="editEntryData.website" class="edit-input">
          </td>
          <td>
            <span *ngIf="editingIndex !== i">{{ entry.username }}</span>
            <input *ngIf="editingIndex === i" [(ngModel)]="editEntryData.username" class="edit-input">
          </td>
          <td>
            <span *ngIf="editingIndex !== i" class="password-cell">
              <span>{{ entry.isVisible ? entry.password : '••••••••' }}</span>
              <button mat-icon-button (click)="toggleVisibility(entry)" matTooltip="Afficher/Cacher">
                <mat-icon>{{ entry.isVisible ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
            </span>
            <input *ngIf="editingIndex === i" [(ngModel)]="editEntryData.password" class="edit-input">
          </td>
          <td class="actions-col">
            <div *ngIf="editingIndex !== i" class="button-group">
              <button mat-icon-button (click)="startEdit(i)" matTooltip="Modifier">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button (click)="deleteEntry(i)" matTooltip="Supprimer" color="warn">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
            <div *ngIf="editingIndex === i" class="button-group">
              <button mat-icon-button (click)="saveEdit(i)" matTooltip="Enregistrer" color="primary">
                <mat-icon>save</mat-icon>
              </button>
              <button mat-icon-button (click)="cancelEdit()" matTooltip="Annuler">
                <mat-icon>cancel</mat-icon>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <form class="add-form" (ngSubmit)="addPassword()">
    <h2>Ajouter un identifiant</h2>
    <input [(ngModel)]="newEntry.website" name="website" placeholder="Site Web (ex: google.com)" required>
    <input [(ngModel)]="newEntry.username" name="username" placeholder="Identifiant / Email" required>
    <input [(ngModel)]="newEntry.password" name="password" type="password" placeholder="Mot de passe" required>
    <div class="actions">
      <button type="submit" mat-raised-button color="primary">Ajouter</button>
      <button type="button" (click)="closeWindow()" mat-button>Fermer</button>
    </div>
  </form>
</div>